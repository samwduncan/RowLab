---
phase: 17-design-overhaul
plan: 07
type: execute
wave: 4
depends_on: ["17-01", "17-03", "17-05", "17-06"]
files_modified:
  - src/v2/styles/responsive.css
  - src/v2/components/shell/MobileNav.tsx
  - src/v2/components/common/MobileCard.tsx
autonomous: true

must_haves:
  truths:
    - "Mobile navigation uses bottom tab pattern with 44px tap targets"
    - "Tables transform to stacked cards on mobile (< 640px)"
    - "All interactive elements have 44px minimum touch targets"
    - "Safe area insets are respected on notched devices"
  artifacts:
    - path: "src/v2/styles/responsive.css"
      provides: "Mobile-first responsive utilities"
      contains: "min-width: 44px"
    - path: "src/v2/components/shell/MobileNav.tsx"
      provides: "Bottom tab navigation"
      contains: "fixed bottom-0"
    - path: "src/v2/components/common/MobileCard.tsx"
      provides: "Table-to-card mobile view"
      contains: "swipe"
  key_links:
    - from: "responsive.css"
      to: "tokens.css"
      via: "CSS custom properties"
      pattern: "var\\(--color-"
---

<objective>
Implement mobile responsive overhaul per DESIGN-06 requirements.

Purpose: Coaches use tablets and phones at practice/regattas. The app must work flawlessly on mobile with proper touch targets, bottom navigation, and card-based layouts instead of tables. This is critical for the "Rowing Instrument" to be useful on the dock.

Output: Updated responsive.css, polished MobileNav.tsx, new MobileCard.tsx for table replacement
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/17-design-overhaul/17-CONTEXT.md
@src/v2/styles/responsive.css
@src/v2/components/shell/MobileNav.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Enhance responsive.css with mobile utilities</name>
  <files>src/v2/styles/responsive.css</files>
  <action>
Enhance responsive utilities for DESIGN-06 mobile requirements:

Add new mobile utility classes:

```css
/* ========================================
   MOBILE TOUCH TARGET ENFORCEMENT
   WCAG 2.1 AAA requires 44px minimum
   ======================================== */

/* Force 44px touch targets on mobile */
@media (max-width: 767px) {
  .v2 .touch-target-mobile {
    min-width: 44px;
    min-height: 44px;
  }

  .v2 button:not(.touch-override),
  .v2 a:not(.touch-override),
  .v2 [role="button"]:not(.touch-override) {
    min-height: 44px;
  }

  /* Larger touch targets for primary actions */
  .v2 .touch-target-lg {
    min-width: 48px;
    min-height: 48px;
  }
}

/* ========================================
   MOBILE-FIRST GRID SYSTEM
   ======================================== */

/* Stack on mobile, grid on tablet+ */
.v2 .mobile-stack-grid {
  display: grid;
  gap: 1rem;
  grid-template-columns: 1fr;
}

@media (min-width: 640px) {
  .v2 .mobile-stack-grid.sm-cols-2 {
    grid-template-columns: repeat(2, 1fr);
  }
}

@media (min-width: 768px) {
  .v2 .mobile-stack-grid.md-cols-2 {
    grid-template-columns: repeat(2, 1fr);
  }
  .v2 .mobile-stack-grid.md-cols-3 {
    grid-template-columns: repeat(3, 1fr);
  }
}

@media (min-width: 1024px) {
  .v2 .mobile-stack-grid.lg-cols-3 {
    grid-template-columns: repeat(3, 1fr);
  }
  .v2 .mobile-stack-grid.lg-cols-4 {
    grid-template-columns: repeat(4, 1fr);
  }
}

/* ========================================
   SWIPE GESTURE SUPPORT
   ======================================== */

.v2 .swipe-container {
  overflow-x: auto;
  scroll-snap-type: x mandatory;
  -webkit-overflow-scrolling: touch;
  scrollbar-width: none;
}

.v2 .swipe-container::-webkit-scrollbar {
  display: none;
}

.v2 .swipe-item {
  scroll-snap-align: start;
  flex-shrink: 0;
}

/* ========================================
   MOBILE CARD VIEW FOR TABLES
   ======================================== */

@media (max-width: 639px) {
  /* Hide table headers on mobile */
  .v2 .mobile-cards-view thead {
    display: none;
  }

  /* Transform rows to cards */
  .v2 .mobile-cards-view tbody {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
  }

  .v2 .mobile-cards-view tr {
    display: flex;
    flex-direction: column;
    padding: 1rem;
    background: var(--color-bg-surface);
    border: 1px solid var(--color-border-subtle);
    border-radius: 0.75rem;
    gap: 0.5rem;
  }

  .v2 .mobile-cards-view td {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.25rem 0;
    border: none;
  }

  .v2 .mobile-cards-view td::before {
    content: attr(data-label);
    font-size: 0.75rem;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--color-text-tertiary);
  }
}

/* ========================================
   BOTTOM NAVIGATION SPACING
   ======================================== */

/* Content padding when bottom nav is present */
.v2 .has-bottom-nav {
  padding-bottom: calc(4rem + env(safe-area-inset-bottom, 0px));
}

/* Safe area for bottom nav */
@supports (padding-bottom: env(safe-area-inset-bottom)) {
  .v2 .bottom-nav-safe {
    padding-bottom: env(safe-area-inset-bottom);
  }
}

/* ========================================
   TABLET SIDEBAR COLLAPSE
   ======================================== */

@media (min-width: 640px) and (max-width: 1023px) {
  .v2 .sidebar-collapsible {
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    width: 280px;
    transform: translateX(-100%);
    transition: transform 0.2s ease-out;
    z-index: 40;
    background: var(--color-bg-surface);
    border-right: 1px solid var(--color-border-subtle);
  }

  .v2 .sidebar-collapsible.sidebar-open {
    transform: translateX(0);
  }

  .v2 .sidebar-overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: var(--color-bg-overlay);
    z-index: 35;
  }

  .v2 .sidebar-collapsible.sidebar-open + .sidebar-overlay {
    display: block;
  }
}
```
  </action>
  <verify>
grep "min-width: 44px" src/v2/styles/responsive.css returns match
grep "scroll-snap-type" src/v2/styles/responsive.css returns match
grep "mobile-cards-view" src/v2/styles/responsive.css returns match
  </verify>
  <done>
responsive.css has 44px touch targets, swipe support, table-to-card transformation, and sidebar collapse
  </done>
</task>

<task type="auto">
  <name>Task 2: Polish MobileNav.tsx with warm palette</name>
  <files>src/v2/components/shell/MobileNav.tsx</files>
  <action>
Update MobileNav component with warm palette and improved touch targets:

1. Import animation utilities:
```typescript
import { motion } from 'framer-motion';
import { SPRING_FAST, usePrefersReducedMotion } from '../../utils/animations';
```

2. Update styling to use warm palette tokens:
```typescript
const navStyles = `
  fixed bottom-0 left-0 right-0
  bg-[var(--color-bg-surface)]
  border-t border-[var(--color-border-subtle)]
  z-50
  pb-[env(safe-area-inset-bottom,0px)]
`;

const navItemStyles = (isActive: boolean) => cn(
  'flex flex-col items-center justify-center',
  'min-w-[64px] min-h-[52px] px-3 py-2',
  'text-xs font-medium',
  'transition-colors duration-100',
  isActive
    ? 'text-[var(--color-interactive-primary)]'
    : 'text-[var(--color-text-secondary)] hover:text-[var(--color-text-primary)]'
);
```

3. Add subtle animation for active indicator:
```typescript
// Active indicator bar
{isActive && !prefersReducedMotion && (
  <motion.div
    layoutId="mobile-nav-indicator"
    className="absolute top-0 left-1/2 -translate-x-1/2 w-8 h-0.5 bg-[var(--color-interactive-primary)] rounded-full"
    transition={SPRING_FAST}
  />
)}
```

4. Ensure minimum 44px touch targets:
```typescript
// Each nav item should have:
<button
  className={cn(
    navItemStyles(isActive),
    'min-h-[44px] min-w-[44px]' // WCAG 2.1 AAA
  )}
  aria-label={item.label}
  aria-current={isActive ? 'page' : undefined}
>
```

5. Add "More" menu for overflow items:
```typescript
// If more than 4 items, show 4 + More button
const visibleItems = navItems.slice(0, 4);
const overflowItems = navItems.slice(4);
```

6. Ensure proper safe area handling for notched devices.
  </action>
  <verify>
grep "min-h-\\[44px\\]" src/v2/components/shell/MobileNav.tsx returns match
grep "color-interactive-primary" src/v2/components/shell/MobileNav.tsx returns match
grep "safe-area-inset-bottom" src/v2/components/shell/MobileNav.tsx returns match
  </verify>
  <done>
MobileNav.tsx has 44px touch targets, warm palette, active indicator animation, and safe area support
  </done>
</task>

<task type="auto">
  <name>Task 3: Create MobileCard.tsx for swipe actions</name>
  <files>src/v2/components/common/MobileCard.tsx</files>
  <action>
Create MobileCard component for mobile table replacement with swipe actions:

```typescript
import React, { useState, useRef } from 'react';
import { motion, PanInfo, useAnimation } from 'framer-motion';
import { SPRING_CONFIG, usePrefersReducedMotion } from '../../utils/animations';

function cn(...classes: (string | boolean | undefined | null)[]): string {
  return classes.filter(Boolean).join(' ');
}

export interface MobileCardAction {
  id: string;
  label: string;
  icon: React.ReactNode;
  color: 'danger' | 'warning' | 'success' | 'primary';
  onClick: () => void;
}

export interface MobileCardProps {
  children: React.ReactNode;
  leftActions?: MobileCardAction[];
  rightActions?: MobileCardAction[];
  onTap?: () => void;
  className?: string;
}

const actionColors = {
  danger: 'bg-[var(--color-status-error)]',
  warning: 'bg-[var(--color-status-warning)]',
  success: 'bg-[var(--color-status-success)]',
  primary: 'bg-[var(--color-interactive-primary)]',
};

export const MobileCard: React.FC<MobileCardProps> = ({
  children,
  leftActions = [],
  rightActions = [],
  onTap,
  className,
}) => {
  const prefersReducedMotion = usePrefersReducedMotion();
  const controls = useAnimation();
  const [isDragging, setIsDragging] = useState(false);

  const actionWidth = 80; // Width per action button
  const leftActionsWidth = leftActions.length * actionWidth;
  const rightActionsWidth = rightActions.length * actionWidth;

  const handleDragEnd = (event: MouseEvent | TouchEvent | PointerEvent, info: PanInfo) => {
    setIsDragging(false);

    const threshold = actionWidth / 2;
    const { offset, velocity } = info;

    // Swipe right to reveal left actions
    if (offset.x > threshold || velocity.x > 500) {
      if (leftActions.length > 0) {
        controls.start({ x: leftActionsWidth });
        return;
      }
    }

    // Swipe left to reveal right actions
    if (offset.x < -threshold || velocity.x < -500) {
      if (rightActions.length > 0) {
        controls.start({ x: -rightActionsWidth });
        return;
      }
    }

    // Snap back to center
    controls.start({ x: 0 });
  };

  const handleTap = () => {
    if (!isDragging && onTap) {
      onTap();
    }
  };

  const renderActions = (actions: MobileCardAction[], side: 'left' | 'right') => (
    <div
      className={cn(
        'absolute top-0 bottom-0 flex',
        side === 'left' ? 'left-0' : 'right-0',
        side === 'left' ? 'flex-row' : 'flex-row-reverse'
      )}
      style={{ width: actions.length * actionWidth }}
    >
      {actions.map((action) => (
        <button
          key={action.id}
          onClick={action.onClick}
          className={cn(
            'flex flex-col items-center justify-center',
            'w-20 h-full',
            'text-white text-xs font-medium',
            actionColors[action.color]
          )}
          aria-label={action.label}
        >
          <span className="mb-1">{action.icon}</span>
          {action.label}
        </button>
      ))}
    </div>
  );

  if (prefersReducedMotion) {
    // Non-animated fallback
    return (
      <div
        className={cn(
          'relative bg-[var(--color-bg-surface)] border border-[var(--color-border-subtle)] rounded-xl p-4',
          onTap && 'cursor-pointer active:bg-[var(--color-bg-hover)]',
          className
        )}
        onClick={onTap}
      >
        {children}
      </div>
    );
  }

  return (
    <div className="relative overflow-hidden rounded-xl">
      {/* Background actions */}
      {leftActions.length > 0 && renderActions(leftActions, 'left')}
      {rightActions.length > 0 && renderActions(rightActions, 'right')}

      {/* Foreground card */}
      <motion.div
        drag="x"
        dragConstraints={{
          left: rightActions.length > 0 ? -rightActionsWidth : 0,
          right: leftActions.length > 0 ? leftActionsWidth : 0,
        }}
        dragElastic={0.1}
        onDragStart={() => setIsDragging(true)}
        onDragEnd={handleDragEnd}
        animate={controls}
        transition={SPRING_CONFIG}
        onTap={handleTap}
        className={cn(
          'relative bg-[var(--color-bg-surface)] border border-[var(--color-border-subtle)] rounded-xl p-4',
          'cursor-grab active:cursor-grabbing',
          className
        )}
      >
        {children}
      </motion.div>
    </div>
  );
};

/**
 * MobileCardField - Key-value display for mobile card content
 */
export interface MobileCardFieldProps {
  label: string;
  value: React.ReactNode;
  mono?: boolean;
}

export const MobileCardField: React.FC<MobileCardFieldProps> = ({ label, value, mono }) => (
  <div className="flex justify-between items-center py-1.5">
    <span className="text-xs font-medium uppercase tracking-wider text-[var(--color-text-tertiary)]">
      {label}
    </span>
    <span className={cn('text-sm text-[var(--color-text-primary)]', mono && 'font-mono tabular-nums')}>
      {value}
    </span>
  </div>
);

MobileCard.displayName = 'MobileCard';
MobileCardField.displayName = 'MobileCardField';
```
  </action>
  <verify>
grep "swipe" src/v2/components/common/MobileCard.tsx returns match OR
grep "drag=\"x\"" src/v2/components/common/MobileCard.tsx returns match
grep "MobileCardAction" src/v2/components/common/MobileCard.tsx returns match
grep "SPRING_CONFIG" src/v2/components/common/MobileCard.tsx returns match
  </verify>
  <done>
MobileCard.tsx has swipeable card with left/right action reveal and spring physics
  </done>
</task>

</tasks>

<verification>
1. responsive.css has 44px minimum touch target utilities
2. responsive.css has table-to-card mobile transformation
3. MobileNav.tsx uses warm palette tokens
4. MobileNav.tsx has 44px minimum touch targets
5. MobileNav.tsx has safe area inset support
6. MobileCard.tsx has swipe-to-reveal actions
7. MobileCard.tsx uses SPRING_CONFIG for animations
</verification>

<success_criteria>
- All mobile touch targets are at least 44px
- Tables transform to readable cards on mobile
- Bottom nav works with notched devices (safe area)
- Swipe gestures feel natural with spring physics
- Mobile UI uses warm palette consistently
</success_criteria>

<output>
After completion, create `.planning/phases/17-design-overhaul/17-07-SUMMARY.md`
</output>
