---
phase: 17-design-overhaul
plan: 06
type: execute
wave: 3
depends_on: ["17-01", "17-03", "17-04"]
files_modified:
  - src/v2/components/ui/Modal.tsx
  - src/v2/components/ui/Input.tsx
  - src/v2/components/common/Table.tsx
autonomous: true

must_haves:
  truths:
    - "Modal has smooth spring enter/exit animations"
    - "Input has clear focus states with warm border colors"
    - "Table is data-dense but readable with warm borders"
    - "All components use warm stone palette tokens"
  artifacts:
    - path: "src/v2/components/ui/Modal.tsx"
      provides: "Modal with spring animations"
      contains: "MODAL_VARIANTS"
    - path: "src/v2/components/ui/Input.tsx"
      provides: "Input with warm focus states"
      contains: "focus:border"
    - path: "src/v2/components/common/Table.tsx"
      provides: "Data-dense table with warm styling"
      contains: "border-[var(--color-border"
  key_links:
    - from: "Modal.tsx"
      to: "animations.ts"
      via: "MODAL_VARIANTS import"
      pattern: "MODAL_VARIANTS"
---

<objective>
Update Modal, Input, and Table components with warm palette and animations.

Purpose: These are foundational UI components used throughout the app. Modal needs smooth enter/exit, Input needs clear validation states, and Table needs to be data-dense yet readable - critical for the "precision instrument" data-forward aesthetic.

Output: Updated Modal.tsx, Input.tsx, and Table.tsx (or create if needed)
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/17-design-overhaul/17-CONTEXT.md
@src/v2/components/ui/Modal.tsx
@src/v2/utils/animations.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update Modal.tsx with spring animations</name>
  <files>src/v2/components/ui/Modal.tsx</files>
  <action>
Update Modal component with smooth enter/exit animations:

1. Import animation presets:
```typescript
import { motion, AnimatePresence } from 'framer-motion';
import { SPRING_CONFIG, MODAL_VARIANTS, usePrefersReducedMotion } from '../../utils/animations';
```

2. Use MODAL_VARIANTS for content animation:
```typescript
const contentAnimation = prefersReducedMotion
  ? {}
  : {
      variants: MODAL_VARIANTS,
      initial: 'hidden',
      animate: 'visible',
      exit: 'exit',
      transition: SPRING_CONFIG,
    };
```

3. Add backdrop animation:
```typescript
const backdropAnimation = prefersReducedMotion
  ? {}
  : {
      initial: { opacity: 0 },
      animate: { opacity: 1 },
      exit: { opacity: 0 },
      transition: { duration: 0.15 },
    };
```

4. Update styling to use warm palette:
```typescript
// Backdrop
const backdropStyles = `
  fixed inset-0 z-50
  bg-[var(--color-bg-overlay)]
  backdrop-blur-sm
`;

// Modal content
const contentStyles = `
  relative z-50
  bg-[var(--color-bg-surface)]
  border border-[var(--color-border-subtle)]
  rounded-2xl
  shadow-xl
  max-h-[90vh] overflow-y-auto
`;

// Size variants
const sizeStyles = {
  sm: 'max-w-sm w-full mx-4',
  md: 'max-w-md w-full mx-4',
  lg: 'max-w-lg w-full mx-4',
  xl: 'max-w-xl w-full mx-4',
  full: 'max-w-4xl w-full mx-4',
};
```

5. Ensure AnimatePresence wraps the modal for exit animations.

6. Add ModalHeader, ModalBody, ModalFooter sub-components:
```typescript
export const ModalHeader: React.FC<{ title: string; onClose?: () => void }> = ({ title, onClose }) => (
  <div className="flex items-center justify-between px-6 py-4 border-b border-[var(--color-border-subtle)]">
    <h2 className="text-lg font-semibold text-[var(--color-text-primary)]">{title}</h2>
    {onClose && (
      <IconButton icon={<X />} aria-label="Close modal" onClick={onClose} variant="ghost" size="sm" />
    )}
  </div>
);

export const ModalBody: React.FC<React.HTMLAttributes<HTMLDivElement>> = ({ className, ...props }) => (
  <div className={cn('px-6 py-4', className)} {...props} />
);

export const ModalFooter: React.FC<React.HTMLAttributes<HTMLDivElement>> = ({ className, ...props }) => (
  <div className={cn('px-6 py-4 border-t border-[var(--color-border-subtle)] flex justify-end gap-3', className)} {...props} />
);
```
  </action>
  <verify>
grep "MODAL_VARIANTS" src/v2/components/ui/Modal.tsx returns match
grep "SPRING_CONFIG" src/v2/components/ui/Modal.tsx returns match
grep "backdrop-blur-sm" src/v2/components/ui/Modal.tsx returns match
  </verify>
  <done>
Modal.tsx has spring enter/exit animations and warm palette styling
  </done>
</task>

<task type="auto">
  <name>Task 2: Create/Update Input.tsx with validation states</name>
  <files>src/v2/components/ui/Input.tsx</files>
  <action>
Create or update Input component with clear focus and validation states:

```typescript
import React, { forwardRef } from 'react';

function cn(...classes: (string | boolean | undefined | null)[]): string {
  return classes.filter(Boolean).join(' ');
}

export interface InputProps extends React.InputHTMLAttributes<HTMLInputElement> {
  label?: string;
  error?: string;
  hint?: string;
  leftIcon?: React.ReactNode;
  rightIcon?: React.ReactNode;
}

export const Input = forwardRef<HTMLInputElement, InputProps>(
  ({ label, error, hint, leftIcon, rightIcon, className, id, ...props }, ref) => {
    const inputId = id || (label ? label.toLowerCase().replace(/\s/g, '-') : undefined);

    const baseInputStyles = `
      w-full px-3 py-2
      bg-[var(--color-input-bg)]
      border border-[var(--color-input-border)]
      rounded-lg
      text-[var(--color-input-text)]
      placeholder:text-[var(--color-input-placeholder)]
      transition-colors duration-150
      focus:outline-none focus:ring-2 focus:ring-[var(--color-interactive-primary)]/20
      focus:border-[var(--color-interactive-primary)]
      disabled:bg-[var(--color-bg-surface)] disabled:text-[var(--color-text-muted)] disabled:cursor-not-allowed
    `;

    const errorInputStyles = error
      ? 'border-[var(--color-status-error)] focus:ring-[var(--color-status-error)]/20 focus:border-[var(--color-status-error)]'
      : '';

    const iconPaddingStyles = leftIcon ? 'pl-10' : '';

    return (
      <div className="space-y-1.5">
        {label && (
          <label
            htmlFor={inputId}
            className="block text-sm font-medium text-[var(--color-text-secondary)]"
          >
            {label}
          </label>
        )}
        <div className="relative">
          {leftIcon && (
            <span className="absolute left-3 top-1/2 -translate-y-1/2 text-[var(--color-text-tertiary)]">
              {leftIcon}
            </span>
          )}
          <input
            ref={ref}
            id={inputId}
            className={cn(baseInputStyles, errorInputStyles, iconPaddingStyles, className)}
            aria-invalid={error ? 'true' : undefined}
            aria-describedby={error ? `${inputId}-error` : hint ? `${inputId}-hint` : undefined}
            {...props}
          />
          {rightIcon && (
            <span className="absolute right-3 top-1/2 -translate-y-1/2 text-[var(--color-text-tertiary)]">
              {rightIcon}
            </span>
          )}
        </div>
        {error && (
          <p id={`${inputId}-error`} className="text-sm text-[var(--color-status-error)]" role="alert">
            {error}
          </p>
        )}
        {hint && !error && (
          <p id={`${inputId}-hint`} className="text-sm text-[var(--color-text-tertiary)]">
            {hint}
          </p>
        )}
      </div>
    );
  }
);

Input.displayName = 'Input';

/**
 * Textarea variant
 */
export interface TextareaProps extends React.TextareaHTMLAttributes<HTMLTextAreaElement> {
  label?: string;
  error?: string;
  hint?: string;
}

export const Textarea = forwardRef<HTMLTextAreaElement, TextareaProps>(
  ({ label, error, hint, className, id, ...props }, ref) => {
    const inputId = id || (label ? label.toLowerCase().replace(/\s/g, '-') : undefined);

    const baseStyles = `
      w-full px-3 py-2 min-h-[100px]
      bg-[var(--color-input-bg)]
      border border-[var(--color-input-border)]
      rounded-lg
      text-[var(--color-input-text)]
      placeholder:text-[var(--color-input-placeholder)]
      transition-colors duration-150
      focus:outline-none focus:ring-2 focus:ring-[var(--color-interactive-primary)]/20
      focus:border-[var(--color-interactive-primary)]
      disabled:bg-[var(--color-bg-surface)] disabled:text-[var(--color-text-muted)]
      resize-y
    `;

    const errorStyles = error
      ? 'border-[var(--color-status-error)] focus:ring-[var(--color-status-error)]/20 focus:border-[var(--color-status-error)]'
      : '';

    return (
      <div className="space-y-1.5">
        {label && (
          <label htmlFor={inputId} className="block text-sm font-medium text-[var(--color-text-secondary)]">
            {label}
          </label>
        )}
        <textarea
          ref={ref}
          id={inputId}
          className={cn(baseStyles, errorStyles, className)}
          aria-invalid={error ? 'true' : undefined}
          {...props}
        />
        {error && (
          <p className="text-sm text-[var(--color-status-error)]" role="alert">
            {error}
          </p>
        )}
        {hint && !error && (
          <p className="text-sm text-[var(--color-text-tertiary)]">{hint}</p>
        )}
      </div>
    );
  }
);

Textarea.displayName = 'Textarea';
```
  </action>
  <verify>
grep "color-input-bg" src/v2/components/ui/Input.tsx returns match
grep "color-status-error" src/v2/components/ui/Input.tsx returns match
grep "focus:ring-2" src/v2/components/ui/Input.tsx returns match
  </verify>
  <done>
Input.tsx has clear focus states, error styling, and warm palette tokens
  </done>
</task>

<task type="auto">
  <name>Task 3: Create/Update Table.tsx with data-dense styling</name>
  <files>src/v2/components/common/Table.tsx</files>
  <action>
Create or update Table component with data-dense but readable styling:

```typescript
import React from 'react';

function cn(...classes: (string | boolean | undefined | null)[]): string {
  return classes.filter(Boolean).join(' ');
}

export interface TableProps extends React.TableHTMLAttributes<HTMLTableElement> {
  compact?: boolean;
}

export const Table: React.FC<TableProps> = ({ compact = false, className, ...props }) => (
  <div className="w-full overflow-x-auto rounded-lg border border-[var(--color-border-subtle)]">
    <table
      className={cn(
        'w-full border-collapse',
        compact ? 'text-sm' : 'text-base',
        className
      )}
      {...props}
    />
  </div>
);

export const TableHeader: React.FC<React.HTMLAttributes<HTMLTableSectionElement>> = ({
  className,
  ...props
}) => (
  <thead
    className={cn(
      'bg-[var(--color-bg-surface)]',
      className
    )}
    {...props}
  />
);

export const TableBody: React.FC<React.HTMLAttributes<HTMLTableSectionElement>> = ({
  className,
  ...props
}) => (
  <tbody className={cn('divide-y divide-[var(--color-border-subtle)]', className)} {...props} />
);

export const TableRow: React.FC<React.HTMLAttributes<HTMLTableRowElement> & { hoverable?: boolean }> = ({
  hoverable = true,
  className,
  ...props
}) => (
  <tr
    className={cn(
      'transition-colors duration-100',
      hoverable && 'hover:bg-[var(--color-bg-hover)]',
      className
    )}
    {...props}
  />
);

export const TableHead: React.FC<React.ThHTMLAttributes<HTMLTableCellElement>> = ({
  className,
  ...props
}) => (
  <th
    className={cn(
      'px-4 py-3 text-left',
      'text-xs font-semibold uppercase tracking-wider',
      'text-[var(--color-text-secondary)]',
      'border-b border-[var(--color-border-default)]',
      className
    )}
    {...props}
  />
);

export const TableCell: React.FC<React.TdHTMLAttributes<HTMLTableCellElement> & { mono?: boolean }> = ({
  mono = false,
  className,
  ...props
}) => (
  <td
    className={cn(
      'px-4 py-3',
      'text-[var(--color-text-primary)]',
      mono && 'font-mono tabular-nums',
      className
    )}
    {...props}
  />
);

/**
 * DataCell - special cell for numeric/metric data
 * Uses monospace font and right alignment
 */
export const DataCell: React.FC<React.TdHTMLAttributes<HTMLTableCellElement>> = ({
  className,
  ...props
}) => (
  <td
    className={cn(
      'px-4 py-3 text-right',
      'font-mono tabular-nums',
      'text-[var(--color-text-primary)]',
      className
    )}
    {...props}
  />
);

/**
 * StatusCell - cell with colored status indicator
 */
export interface StatusCellProps extends React.TdHTMLAttributes<HTMLTableCellElement> {
  status: 'success' | 'warning' | 'error' | 'info' | 'neutral';
}

const statusColors = {
  success: 'text-[var(--color-status-success)]',
  warning: 'text-[var(--color-status-warning)]',
  error: 'text-[var(--color-status-error)]',
  info: 'text-[var(--color-status-info)]',
  neutral: 'text-[var(--color-text-secondary)]',
};

export const StatusCell: React.FC<StatusCellProps> = ({ status, className, ...props }) => (
  <td className={cn('px-4 py-3 font-medium', statusColors[status], className)} {...props} />
);
```
  </action>
  <verify>
grep "divide-\\[var(--color-border" src/v2/components/common/Table.tsx returns match
grep "tabular-nums" src/v2/components/common/Table.tsx returns match
grep "DataCell" src/v2/components/common/Table.tsx returns match
  </verify>
  <done>
Table.tsx has data-dense styling with warm borders, monospace data cells, and status indicators
  </done>
</task>

</tasks>

<verification>
1. Modal uses MODAL_VARIANTS and SPRING_CONFIG for animations
2. Modal has backdrop-blur-sm on overlay
3. Input has focus ring with interactive-primary color
4. Input has error state with status-error color
5. Table has compact row spacing with divide borders
6. DataCell uses tabular-nums for aligned numbers
7. All components use var(--color-*) tokens
</verification>

<success_criteria>
- Modal enters/exits smoothly with spring physics
- Input clearly shows focus state and validation errors
- Table is data-dense but readable with proper alignment
- Numeric data columns align correctly (tabular-nums)
- All components use warm palette exclusively
</success_criteria>

<output>
After completion, create `.planning/phases/17-design-overhaul/17-06-SUMMARY.md`
</output>
