---
phase: 18-lineup-boat-improvements
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/v2/types/rigging.ts
  - src/v2/types/lineupTemplate.ts
  - src/v2/types/equipment.ts
autonomous: true

must_haves:
  truths:
    - "TypeScript types define rigging profile structure"
    - "TypeScript types define lineup template structure"
    - "TypeScript types define equipment assignment and conflict structure"
  artifacts:
    - path: "src/v2/types/rigging.ts"
      provides: "RiggingProfile, RiggingDefaults types"
      exports: ["RiggingProfile", "RiggingDefaults"]
    - path: "src/v2/types/lineupTemplate.ts"
      provides: "LineupTemplate, TemplateAssignment types"
      exports: ["LineupTemplate", "TemplateAssignment"]
    - path: "src/v2/types/equipment.ts"
      provides: "EquipmentAssignment, EquipmentConflict types"
      exports: ["EquipmentAssignment", "EquipmentConflict"]
  key_links:
    - from: "src/v2/types/rigging.ts"
      to: "Shell"
      via: "shellId reference"
      pattern: "shellId.*string"
---

<objective>
Create TypeScript types for rigging profiles, lineup templates, and equipment tracking.

Purpose: Type safety for all Phase 18 features - ensures consistent data structures across hooks, components, and API calls.
Output: Three type definition files with comprehensive interfaces.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/18-lineup-boat-improvements/18-RESEARCH.md
@prisma/schema.prisma
@src/v2/types/lineup.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create rigging types</name>
  <files>src/v2/types/rigging.ts</files>
  <action>
Create `src/v2/types/rigging.ts` with:

```typescript
/**
 * Rigging types for Phase 18 - BOAT-02
 *
 * Standard values (from World Rowing / Concept2):
 * - Spread (sweep): 83-87 cm
 * - Span (scull): 158-160 cm (2x spread)
 * - Catch angle: -58° (sweep), -60° (scull)
 * - Finish angle: 33° (sweep), 35° (scull)
 * - Oar length: Sweep 362-378 cm, Scull 274-292 cm
 * - Inboard: Sweep 112-116 cm, Scull 87-89 cm
 * - Pitch: 4° (modern standard)
 * - Gate height: Sweep 170±15 mm, Scull 160±15 mm
 */

/**
 * Core rigging measurements - stored as JSON in database
 */
export interface RiggingDefaults {
  /** Spread in cm (sweep boats, typical: 83-87) */
  spread?: number;
  /** Span in cm (sculling boats, typical: 158-160) */
  span?: number;
  /** Catch angle in degrees (typical: -58 sweep, -60 scull) */
  catchAngle?: number;
  /** Finish angle in degrees (typical: 33 sweep, 35 scull) */
  finishAngle?: number;
  /** Oar length in cm (sweep: 362-378, scull: 274-292) */
  oarLength?: number;
  /** Inboard length in cm (sweep: 112-116, scull: 87-89) */
  inboard?: number;
  /** Pitch in degrees (modern standard: 4) */
  pitch?: number;
  /** Gate height in mm from seat (sweep: 170±15, scull: 160±15) */
  gateHeight?: number;
}

/**
 * Per-seat rigging overrides
 */
export type PerSeatRigging = Record<number, Partial<RiggingDefaults>>;

/**
 * Full rigging profile linked to a shell
 */
export interface RiggingProfile {
  id: string;
  shellId: string;
  teamId: string;
  defaults: RiggingDefaults;
  perSeat?: PerSeatRigging | null;
  notes?: string | null;
  createdAt: string;
  updatedAt: string;
}

/**
 * Input for creating/updating rigging profile
 */
export interface RiggingProfileInput {
  shellId: string;
  defaults: RiggingDefaults;
  perSeat?: PerSeatRigging | null;
  notes?: string | null;
}

/**
 * Default rigging values by boat class
 */
export const DEFAULT_RIGGING: Record<string, RiggingDefaults> = {
  '8+': {
    spread: 85,
    catchAngle: -58,
    finishAngle: 33,
    oarLength: 372,
    inboard: 114,
    pitch: 4,
    gateHeight: 170,
  },
  '4+': {
    spread: 86,
    catchAngle: -58,
    finishAngle: 33,
    oarLength: 372,
    inboard: 114,
    pitch: 4,
    gateHeight: 170,
  },
  '4-': {
    spread: 86,
    catchAngle: -58,
    finishAngle: 33,
    oarLength: 372,
    inboard: 114,
    pitch: 4,
    gateHeight: 170,
  },
  '4x': {
    span: 158,
    catchAngle: -60,
    finishAngle: 35,
    oarLength: 284,
    inboard: 88,
    pitch: 4,
    gateHeight: 160,
  },
  '2x': {
    span: 160,
    catchAngle: -60,
    finishAngle: 35,
    oarLength: 287,
    inboard: 88,
    pitch: 4,
    gateHeight: 160,
  },
  '2-': {
    spread: 86,
    catchAngle: -58,
    finishAngle: 33,
    oarLength: 372,
    inboard: 114,
    pitch: 4,
    gateHeight: 170,
  },
  '1x': {
    span: 160,
    catchAngle: -60,
    finishAngle: 35,
    oarLength: 289,
    inboard: 88,
    pitch: 4,
    gateHeight: 160,
  },
};

/**
 * Check if boat class uses sculling (span) vs sweep (spread)
 */
export function isScullBoat(boatClass: string): boolean {
  return boatClass.includes('x') || boatClass === '1x';
}
```
  </action>
  <verify>Run `npx tsc --noEmit src/v2/types/rigging.ts` - should compile without errors.</verify>
  <done>Rigging types file created with RiggingDefaults, RiggingProfile, and default values.</done>
</task>

<task type="auto">
  <name>Task 2: Create lineup template types</name>
  <files>src/v2/types/lineupTemplate.ts</files>
  <action>
Create `src/v2/types/lineupTemplate.ts` with:

```typescript
/**
 * Lineup template types for Phase 18 - LINEUP-03
 */

import type { RiggingDefaults } from './rigging';

/**
 * Template assignment - seat configuration
 */
export interface TemplateAssignment {
  seatNumber: number;
  side: 'Port' | 'Starboard';
  /** Optional preferred athlete - templates can be generic or athlete-specific */
  preferredAthleteId?: string | null;
  /** Optional athlete name for display when ID not resolved */
  preferredAthleteName?: string | null;
}

/**
 * Lineup template - reusable lineup configuration
 */
export interface LineupTemplate {
  id: string;
  teamId: string;
  name: string;
  description?: string | null;
  boatClass: string;
  assignments: TemplateAssignment[];
  /** Optional rigging snapshot */
  rigging?: RiggingDefaults | null;
  /** Mark as default for this boat class */
  isDefault: boolean;
  createdAt: string;
  updatedAt: string;
}

/**
 * Input for creating lineup template
 */
export interface LineupTemplateInput {
  name: string;
  description?: string | null;
  boatClass: string;
  assignments: TemplateAssignment[];
  rigging?: RiggingDefaults | null;
  isDefault?: boolean;
}

/**
 * Input for updating lineup template
 */
export interface LineupTemplateUpdateInput {
  name?: string;
  description?: string | null;
  assignments?: TemplateAssignment[];
  rigging?: RiggingDefaults | null;
  isDefault?: boolean;
}

/**
 * Template applied result - what happens when applying a template
 */
export interface AppliedTemplate {
  templateId: string;
  templateName: string;
  boatClass: string;
  /** Athletes actually assigned (resolved from preferredAthleteId) */
  assignedAthletes: Array<{
    seatNumber: number;
    athleteId: string;
    athleteName: string;
    side: 'Port' | 'Starboard';
    /** Whether this athlete was the preferred one or a substitute */
    isPreferred: boolean;
  }>;
  /** Seats that couldn't be filled (athlete unavailable/missing) */
  unfilledSeats: number[];
}
```
  </action>
  <verify>Run `npx tsc --noEmit src/v2/types/lineupTemplate.ts` - should compile without errors.</verify>
  <done>LineupTemplate types file created with template and assignment interfaces.</done>
</task>

<task type="auto">
  <name>Task 3: Create equipment types</name>
  <files>src/v2/types/equipment.ts</files>
  <action>
Create `src/v2/types/equipment.ts` with:

```typescript
/**
 * Equipment assignment and conflict types for Phase 18 - BOAT-03, BOAT-04
 */

/**
 * Equipment assignment - links equipment to lineups/sessions
 */
export interface EquipmentAssignment {
  id: string;
  teamId: string;
  lineupId?: string | null;
  sessionId?: string | null;
  shellId?: string | null;
  oarSetId?: string | null;
  assignedDate: string; // ISO date string (YYYY-MM-DD)
  notes?: string | null;
  createdAt: string;
  /** Resolved names for display */
  shellName?: string | null;
  oarSetName?: string | null;
  lineupName?: string | null;
}

/**
 * Input for creating equipment assignment
 */
export interface EquipmentAssignmentInput {
  lineupId?: string | null;
  sessionId?: string | null;
  shellId?: string | null;
  oarSetId?: string | null;
  assignedDate: string;
  notes?: string | null;
}

/**
 * Equipment conflict types
 */
export type ConflictType = 'double_booking' | 'unavailable' | 'maintenance';

/**
 * Equipment conflict - detected when equipment is double-booked
 */
export interface EquipmentConflict {
  type: ConflictType;
  /** ID of the equipment (shell or oar set) */
  equipmentId: string;
  /** Name for display */
  equipmentName: string;
  /** Type of equipment */
  equipmentType: 'shell' | 'oarSet';
  /** ID of the conflicting lineup/session */
  conflictingId: string;
  /** Name of conflicting lineup/session */
  conflictingName: string;
  /** Date of conflict */
  conflictDate: string;
  /** Human-readable message */
  message: string;
}

/**
 * Shell with extended info for equipment picker
 */
export interface ShellWithStatus {
  id: string;
  name: string;
  boatClass: string;
  type: 'EIGHT' | 'FOUR' | 'QUAD' | 'DOUBLE' | 'PAIR' | 'SINGLE';
  weightClass: 'HEAVYWEIGHT' | 'LIGHTWEIGHT' | 'OPENWEIGHT';
  rigging: 'SWEEP' | 'SCULL';
  status: 'AVAILABLE' | 'IN_USE' | 'MAINTENANCE' | 'RETIRED';
  notes?: string | null;
  /** Is this shell assigned for the target date? */
  isAssignedForDate: boolean;
  /** Conflicting assignment if any */
  conflict?: EquipmentConflict | null;
  /** Rigging profile if exists */
  hasRiggingProfile: boolean;
}

/**
 * Oar set with extended info for equipment picker
 */
export interface OarSetWithStatus {
  id: string;
  name: string;
  type: 'SWEEP' | 'SCULL';
  count: number;
  status: 'AVAILABLE' | 'IN_USE' | 'MAINTENANCE' | 'RETIRED';
  notes?: string | null;
  /** Is this oar set assigned for the target date? */
  isAssignedForDate: boolean;
  /** Conflicting assignment if any */
  conflict?: EquipmentConflict | null;
}

/**
 * Equipment availability check result
 */
export interface EquipmentAvailability {
  date: string;
  shells: ShellWithStatus[];
  oarSets: OarSetWithStatus[];
  /** Total conflicts found */
  conflictCount: number;
}

/**
 * Historical lineup search filters
 */
export interface LineupSearchFilters {
  /** Filter by athlete IDs (any match) */
  athleteIds?: string[];
  /** Minimum number of specified athletes that must be in lineup */
  minAthletes?: number;
  /** Filter by boat classes */
  boatClasses?: string[];
  /** Filter by shell names */
  shellNames?: string[];
  /** Date range start */
  startDate?: string;
  /** Date range end */
  endDate?: string;
  /** Search in lineup name */
  nameSearch?: string;
  /** Sort by */
  sortBy?: 'date' | 'name' | 'createdAt';
  /** Sort direction */
  sortDirection?: 'asc' | 'desc';
}

/**
 * Lineup with metadata for historical search results
 */
export interface LineupSearchResult {
  id: string;
  name: string;
  notes?: string | null;
  createdAt: string;
  updatedAt: string;
  /** Number of athletes in this lineup */
  athleteCount: number;
  /** Boat classes used */
  boatClasses: string[];
  /** Shells used (if any) */
  shellNames: string[];
  /** Match score for "at least N athletes" queries */
  matchedAthleteCount?: number;
}
```
  </action>
  <verify>Run `npx tsc --noEmit src/v2/types/equipment.ts` - should compile without errors.</verify>
  <done>Equipment types file created with assignment, conflict, and search filter interfaces.</done>
</task>

</tasks>

<verification>
- [ ] `npx tsc --noEmit src/v2/types/rigging.ts` passes
- [ ] `npx tsc --noEmit src/v2/types/lineupTemplate.ts` passes
- [ ] `npx tsc --noEmit src/v2/types/equipment.ts` passes
- [ ] All types are properly exported
- [ ] Default rigging values match World Rowing standards
</verification>

<success_criteria>
1. All three type files compile without TypeScript errors
2. Types cover all Phase 18 requirements (rigging, templates, equipment, search)
3. Default rigging values documented and correct
4. Types are reusable across hooks and components
</success_criteria>

<output>
After completion, create `.planning/phases/18-lineup-boat-improvements/18-02-SUMMARY.md`
</output>
