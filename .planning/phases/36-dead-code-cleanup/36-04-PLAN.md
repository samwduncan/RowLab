---
phase: 36-dead-code-cleanup
plan: 04
type: execute
wave: 4
depends_on: ["36-03"]
files_modified:
  - src/store/aiLineupStore.js
  - src/store/announcementStore.js
  - src/store/boatConfigStore.js
  - src/store/combinedScoringStore.js
  - src/store/csvImportStore.js
  - src/store/ergDataStore.js
  - src/store/rankingsStore.js
  - src/store/regattaStore.js
  - src/store/seatRaceStore.js
  - src/store/shellStore.js
  - src/store/subscriptionStore.js
  - src/store/teamRankingsStore.js
  - src/store/telemetryStore.js
  - src/store/trainingPlanStore.js
  - src/store/undoMiddleware.js
  - src/v2/styles/v2.css
autonomous: true

must_haves:
  truths:
    - "Canvas pages function correctly without removed Zustand stores"
    - "Auth/landing/callback pages still work"
    - "CSS scoping removal does not break Canvas styling"
    - "Feature toggle system retained if Canvas uses it, removed if not"
    - "Build succeeds with zero errors"
  artifacts:
    - path: "src/store/"
      provides: "Only stores actually imported by Canvas/V2 code remain"
    - path: "src/store/authStore.js"
      provides: "Auth state used by V2Layout"
    - path: "src/store/lineupStore.js"
      provides: "Lineup state used by LineupWorkspace"
    - path: "src/store/settingsStore.js"
      provides: "Settings state used by V2Layout"
  key_links:
    - from: "src/v2/layouts/V2Layout.tsx"
      to: "src/store/authStore"
      via: "import"
      pattern: "from.*store/authStore"
    - from: "src/v2/layouts/V2Layout.tsx"
      to: "src/store/settingsStore"
      via: "import"
      pattern: "from.*store/settingsStore"
---

<objective>
Remove dead Zustand stores, CSS scoping infrastructure, and conditionally remove feature toggle system. Audit each store and infrastructure piece for Canvas usage before deletion.

Purpose: V1 Zustand stores powered V1 pages (now deleted). CSS scoping (.v2 class) was needed when V1 and V2 coexisted. Feature toggles may or may not still be used by Canvas settings.
Output: ~15 dead store files deleted, CSS scoping removed, feature toggle system retained or removed based on audit.
</objective>

<execution_context>
@/home/swd/.claude/get-shit-done/workflows/execute-plan.md
@/home/swd/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/36-dead-code-cleanup/36-RESEARCH.md
@.planning/phases/36-dead-code-cleanup/36-03-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Audit and remove dead Zustand stores</name>
  <files>src/store/</files>
  <action>
**Step 1: Audit each V1 store for Canvas/V2/auth usage.**

For each store in `src/store/`, search for imports across ALL remaining code:
```bash
# Check each store for imports (excluding the store's own test file)
for store in aiLineupStore announcementStore boatConfigStore combinedScoringStore csvImportStore ergDataStore rankingsStore regattaStore seatRaceStore shellStore subscriptionStore teamRankingsStore telemetryStore trainingPlanStore undoMiddleware; do
  echo "=== $store ==="
  grep -r "from.*store/$store\|import.*store/$store" src/ --include="*.{jsx,tsx,ts,js}" -l 2>/dev/null | grep -v "store/$store" | grep -v ".test."
done
```

**Step 2: Also check authStore, lineupStore, settingsStore are still needed.**
```bash
for store in authStore lineupStore settingsStore; do
  echo "=== $store (KEEP) ==="
  grep -r "from.*store/$store\|import.*store/$store" src/ --include="*.{jsx,tsx,ts,js}" -l 2>/dev/null | grep -v "store/$store" | grep -v ".test."
done
```

**Step 3: Delete stores with NO imports found.**

Expected deletions (verify against audit):
```bash
rm src/store/aiLineupStore.js
rm src/store/announcementStore.js
rm src/store/boatConfigStore.js
rm src/store/combinedScoringStore.js
rm src/store/csvImportStore.js
rm src/store/ergDataStore.js
rm src/store/rankingsStore.js
rm src/store/regattaStore.js
rm src/store/seatRaceStore.js
rm src/store/shellStore.js
rm src/store/subscriptionStore.js
rm src/store/teamRankingsStore.js
rm src/store/telemetryStore.js
rm src/store/trainingPlanStore.js
rm src/store/undoMiddleware.js
```

**Step 4: Handle test files.**
- Delete test files for removed stores (e.g., if `authStore.test.ts` and `lineupStore.test.ts` exist, keep them ONLY if their corresponding store is kept)
- If any other `.test.` files reference deleted stores, delete those test files

**Step 5: If ANY store is imported by Canvas/V2 that was expected to be dead, KEEP it.** Document the finding.

**KEEP:**
- `src/store/authStore.js` + `src/store/authStore.test.ts` (used by V2Layout)
- `src/store/lineupStore.js` + `src/store/lineupStore.test.ts` (used by Canvas lineup)
- `src/store/settingsStore.js` (used by V2Layout)
- Any other store found to be imported in the audit

After deletion:
```bash
ls src/store/
# Expected: authStore.js authStore.test.ts lineupStore.js lineupStore.test.ts settingsStore.js (+ any audit additions)
```
  </action>
  <verify>
`ls src/store/` shows only kept stores.
`npm run build` succeeds (run after Task 2).
  </verify>
  <done>Dead Zustand stores deleted, only Canvas-used stores remain</done>
</task>

<task type="auto">
  <name>Task 2: Remove CSS scoping and audit feature toggles</name>
  <files>
    src/v2/styles/v2.css
    src/v2/layouts/V2Layout.tsx
    src/v2/types/feature-toggles.ts
    src/v2/hooks/useFeaturePreference.ts
    src/v2/stores/featurePreferenceStore.ts
  </files>
  <action>
**Part A: CSS Scoping Removal**

**Step 1: Check if v2.css exists and what it contains.**
```bash
cat src/v2/styles/v2.css 2>/dev/null
```

**Step 2: Search for .v2 class usage in CSS.**
```bash
grep -r "\.v2[^a-zA-Z]" src/ --include="*.css" -l 2>/dev/null
```

**Step 3: Search for .v2 className in JSX/TSX.**
```bash
grep -r 'className.*["\x27]v2["\x27]\|className.*v2' src/ --include="*.{jsx,tsx}" -l 2>/dev/null
```

**Step 4: If v2.css is only imported by V2Layout and no Canvas components use `.v2` scoping:**
- Remove `src/v2/styles/v2.css` if it exists
- Remove `.v2` className from V2Layout.tsx if present (the div wrapper)
- Remove any `.v2` scoping from CSS files

**Step 5: If V2Layout.tsx wraps content in a `.v2` div, check if removing it breaks anything.**
Read V2Layout.tsx and check if the `.v2` className is applied. If it is, and `.v2` CSS rules exist in other CSS files, those rules may need to be refactored (remove `.v2` nesting).

**CAUTION:** If removing `.v2` scoping from CSS would break Canvas styling (because Canvas CSS relies on `.v2` specificity), leave it in place and document in the summary.

---

**Part B: Feature Toggle Audit**

**Step 1: Check if Canvas pages use feature toggles.**
```bash
# Check for feature toggle usage in Canvas pages
grep -r "useFeaturePreference\|isFeatureEnabled\|FeatureGuard\|featurePreference\|feature-toggles" src/v2/pages/canvas/ --include="*.{jsx,tsx,ts}" -l 2>/dev/null

# Check for feature toggle usage in Canvas layout
grep -r "useFeaturePreference\|isFeatureEnabled\|FeatureGuard\|featurePreference" src/v2/layouts/CanvasLayout.tsx 2>/dev/null
```

**Step 2: Check if Canvas settings page renders feature toggles.**
```bash
grep -r "FeatureGroupCard\|FeatureToggleRow\|useFeaturePreference\|featurePreference" src/v2/pages/canvas/CanvasSettingsPage.tsx 2>/dev/null
```

**Step 3: Check broader V2 usage.**
```bash
grep -r "useFeaturePreference\|isFeatureEnabled\|FeatureGuard\|featurePreference\|feature-toggles" src/v2/ --include="*.{jsx,tsx,ts}" -l 2>/dev/null | head -20
```

**Decision:**
- If Canvas USES feature toggles (likely for gamification, recruiting, etc.): **KEEP** the entire feature toggle system. Document: "Feature toggles retained — used by Canvas for [list features]."
- If Canvas does NOT use feature toggles: **REMOVE** these files:
  - `src/v2/types/feature-toggles.ts`
  - `src/v2/hooks/useFeaturePreference.ts`
  - `src/v2/stores/featurePreferenceStore.ts`
  - `src/v2/features/settings/components/FeatureGroupCard.tsx`
  - `src/v2/features/settings/components/FeatureToggleRow.tsx`
  </action>
  <verify>
`npm run build` succeeds.
CSS scoping decision documented.
Feature toggle decision documented.
  </verify>
  <done>CSS scoping handled, feature toggle system retained or removed based on audit</done>
</task>

<task type="auto">
  <name>Task 3: Build verification and commit</name>
  <files>dist/</files>
  <action>
Run full verification:
1. `npm run build` — must succeed
2. `npm run test:run 2>&1 | tail -30` — check for failures

If tests fail referencing deleted stores, delete those test files.

Commit:
```bash
git add -A
git commit -m "chore(36-04): remove dead Zustand stores and CSS scoping

- Delete ~15 dead V1 Zustand stores (keep authStore, lineupStore, settingsStore)
- [Remove/retain] CSS .v2 scoping infrastructure
- [Remove/retain] feature toggle system based on Canvas usage audit
- Verify Canvas pages unaffected"
```
  </action>
  <verify>`npm run build` succeeds, git log shows commit</verify>
  <done>Plan 04 complete — dead stores removed, scoping/toggles handled, build passes</done>
</task>

</tasks>

<verification>
1. `npm run build` succeeds with zero errors
2. `src/store/` contains only stores imported by Canvas/V2 code
3. CSS scoping decision documented and implemented
4. Feature toggle decision documented and implemented
5. Canvas pages render correctly without deleted stores
</verification>

<success_criteria>
- ~15 dead Zustand store files deleted
- CSS scoping infrastructure handled (removed or retained with rationale)
- Feature toggle system audited and decision implemented
- Build passes with zero errors
</success_criteria>

<output>
After completion, create `.planning/phases/36-dead-code-cleanup/36-04-SUMMARY.md`
</output>
